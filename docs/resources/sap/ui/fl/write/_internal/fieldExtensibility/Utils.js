/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/security/encodeURL","sap/ui/core/Core","sap/ui/fl/Utils","sap/ui/thirdparty/jquery"],function(e,t,r,n,a){"use strict";var i={v2:"v2",v4:"v4"};function u(e){if(e&&e.split){var t=e.split(".");return t[t.length-1]}return null}function o(e){var t=[];try{var r=JSON.parse(e.responseText);if(r&&r.error&&r.error.message&&r.error.message.value){t.push({severity:"error",text:r.error.message.value})}else{t.push({severity:"error",text:e.responseText})}}catch(e){}return t}function s(t){var r=u(g(t));if(!r){var n=t.getBindingContext?t.getBindingContext():null;if(n&&n.getPath){r=n.getPath()}}if(!r){e.warning("Control not bound to a path")}return r}function l(e,t,r){return e.metadataLoaded().then(function(){var n=null;if(r){var a=e.oMetadata._getEntityTypeByName(r);n=e.oMetadata._getEntitySetByType(a)}if(!n){n=e.oMetadata._getEntitySetByPath(t)}return n?n.name:null})}function f(e,t){var r=e.getMetaModel();var n=r.getMetaPath(t);return r.requestObject(n).then(function(e){var t=r.fetchEntityContainer().getResult();var n=t[t.$EntityContainer];var a=Object.keys(n).filter(function(t){return n[t]===e});return a.length>0&&a[0]})}function c(e,t,r){return e.metadataLoaded().then(function(){var n=null;if(r){n=e.oMetadata._getEntityTypeByName(r)}if(!n){n=e.oMetadata._getEntityTypeByPath(t)}return n?n.name:null})}function v(e,t){var r=e.getMetaModel();var n=r.getMetaPath(t);return r.requestObject(n).then(function(e){return u(e.$Type)})}function g(e){return e.getEntitySet?e.getEntitySet():null}function p(e){return e.getEntityType?e.getEntityType():null}function d(t){var r=null;if(t&&t.sServiceUrl){r=t.sServiceUrl}if(!r){e.warning("Model has no Service Uri")}return r}function y(e){if(e){if(e.isA("sap.ui.model.odata.v2.ODataModel")){return i.v2}else if(e.isA("sap.ui.model.odata.v4.ODataModel")){return i.v4}}return null}function h(t){if(t){var r=t.getModel?t.getModel():null;if(y(r)){return r}e.warning("Unsupported model type or protocol");return null}e.warning("No Control passed");return null}var m={};m.checkControlPrerequisites=function(t){if(t){var r=h(t);var n=d(r);var a=s(t);var i=p(t);return Boolean(n&&(a||i))}e.warning("No Control passed");return false};m.executeRequest=function(e,t){var r=e+this.getUriParameters(t);return new Promise(function(e){var t={type:"GET",async:true,dataType:"json"};a.ajax(r,t).done(function(t){var r=t&&t.d;e({errorOccurred:false,result:r})}).fail(function(t){e({errorOccurred:true,errorMessages:o(t),statusCode:t.status})})})};m.getBoundEntitySet=function(e){var t=h(e);var r=y(t);if(r===i.v2){return l(t,s(e),p(e))}else if(r===i.v4){return f(t,s(e))}return Promise.resolve(null)};m.getBoundEntityType=function(e){var t=h(e);var r=y(t);if(r===i.v2){return c(t,s(e),p(e))}else if(r===i.v4){return v(t,s(e))}return Promise.resolve(null)};m.getNavigationUriForIntent=function(e){return n.getUShellService("CrossApplicationNavigation").then(function(t){if(t&&t.hrefForExternal){return t.hrefForExternal(e)}return Promise.resolve(null)})};m.getServiceUri=function(e){var t=h(e);return d(t)};m.getText=function(e){return r.getLibraryResourceBundle("sap.ui.fl").getText(e)};m.getUriParameters=function(e){if(!e){return""}var r=[];Object.keys(e).forEach(function(n){if(n){var a="'"+t(e[n]||"")+"'";r.push(t(n)+"="+a)}});return r.length===0?"":"?"+r.join("&")};m.isNavigationSupportedForIntents=function(e){return n.getUShellService("CrossApplicationNavigation").then(function(t){if(t&&t.isNavigationSupported){return t.isNavigationSupported(e).then(function(e){return e.map(function(e){return e&&e.supported===true})})}return Promise.resolve(e.map(function(){return false}))})};return m});