/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/write/api/ChangesWriteAPI","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/Utils","sap/ui/fl/ChangePersistenceFactory","sap/base/util/restricted/_union"],function(e,r,t,n,a,i,u){"use strict";var o={};function c(r,t,n){var a={includeDirtyChanges:true,layer:t};var u=i.getChangePersistenceForControl(r);return u.getAllUIChanges(a).filter(function(r){return r.getState()!==e.LifecycleState.DELETED&&r.getVariantReference()===(n||undefined)})}function s(e){var r=a.getAppComponentForControl(e);var t=[];var i=[];function o(r,n){var a=(n||[]).concat(r);if(r===e||t.includes(r)){t=u(t,a);return true}var c=r.getParent();if(i.includes(r)||!c){i=u(i,a);return false}return o(c,a)}function c(e){return e.getDependentSelectorList().map(function(e){return n.bySelector(e,r)}).filter(Boolean).some(function(e){return o(e)})}return c}o.resetChanges=function(e,i){var u=e.slice().reverse();var o=u.map(function(e){var a=n.bySelector(e.getSelector(),i);return function(){return r.remove({change:e,selector:a}).then(function(){e.setQueuedForRevert();return t.revert({change:e,element:a})})}});return a.execPromiseQueueSequentially(o)};o.restoreChanges=function(u,o){var c=u.map(function(a){return function(){a.restorePreviousState();var u=n.bySelector(a.getSelector(),o);r.add({change:a,selector:u});if(a.getState()===e.LifecycleState.PERSISTED){var c=i.getChangePersistenceForControl(o);var s=c.getDirtyChanges();var l=s.indexOf(a);if(l>=0){s.splice(l,1)}}return t.apply({change:a,element:u,modifier:n})}});return a.execPromiseQueueSequentially(c)};o.getNestedUIChangesForControl=function(e,r){var t=c(e,r.layer,r.currentVariant);var n=s(e);return t.filter(n)};o.isResetEnabled=function(e,r){var t=c(e,r.layer,r.currentVariant);var n=s(e);return t.some(n)};return o});